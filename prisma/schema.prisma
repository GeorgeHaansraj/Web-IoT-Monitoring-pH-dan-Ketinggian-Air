// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  password  String
  role      String   @default("user") // "user" or "admin"
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model PHReading {
  id          String   @id @default(cuid())
  value       Float
  location    String   // "kolam" or "sawah"
  timestamp   DateTime @default(now())
  deviceId    String?
  temperature Float?
  
  @@map("ph_readings")
}

model WaterLevelReading {
  id          String   @id @default(cuid())
  level       Float    // in cm or meters
  location    String   // "kolam" or "sawah"
  timestamp   DateTime @default(now())
  deviceId    String?
  status      String   @default("normal") // "low", "normal", "high", "critical"
  
  @@map("water_level_readings")
}

model Alert {
  id          String   @id @default(cuid())
  type        String   // "ph_high", "ph_low", "water_low", "water_high"
  message     String
  location    String
  severity    String   @default("medium") // "low", "medium", "high", "critical"
  isRead      Boolean  @default(false)
  createdAt   DateTime @default(now())
  resolvedAt  DateTime?
  
  @@map("alerts")
}

model DeviceStatus {
  id         String   @id @default("global-device")
  activeMode String   // "sawah" or "kolam"
  battery    Float?   // Battery percentage
  signal     Int?     // Signal strength
  lastUpdate DateTime @updatedAt
  
  @@map("device_status")
}
model PumpStatus {
  id        String   @id @default(cuid())
  mode      String   @unique // "sawah" or "kolam"
  isOn      Boolean  @default(false)
  updatedAt DateTime @updatedAt
  createdAt DateTime @default(now())
  
  @@map("pump_status")
}

model PumpHistory {
  id           String   @id @default(cuid())
  mode         String   // "sawah" or "kolam"
  previousState Boolean
  newState     Boolean
  changedBy    String   @default("dashboard") // "dashboard", "esp", "manual"
  userId       String?  // Optional: who triggered it
  timestamp    DateTime @default(now())
  
  @@map("pump_history")
  @@index([mode, timestamp])
}

model MonitoringLog {
  id             String   @id @default(cuid())
  battery_level  Float?   // Battery percentage (0-100)
  ph_value       Float?   // pH value (0-14)
  level          Float?   // Water level in cm
  temperature    Float?   // Temperature from pH sensor
  signal_strength Int?    // Signal quality (CSQ)
  created_at     DateTime @default(now())
  deviceId       String?  // Device identifier
  
  @@map("monitoring_logs")
  @@index([created_at])
}