// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  password  String
  role      String   @default("user") // "user" or "admin"
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model PHReading {
  id          String   @id @default(cuid())
  value       Float
  location    String // "kolam" or "sawah"
  timestamp   DateTime @default(now())
  deviceId    String?
  temperature Float?

  @@map("ph_readings")
}

model WaterLevelReading {
  id        String   @id @default(cuid())
  level     Float // in cm or meters
  timestamp DateTime @default(now())
  
  @@map("water_level_readings")
}

model Alert {
  id         String    @id @default(cuid())
  type       String // "ph_high", "ph_low", "water_low", "water_high"
  message    String
  location   String
  severity   String    @default("medium") // "low", "medium", "high", "critical"
  isRead     Boolean   @default(false)
  createdAt  DateTime  @default(now())
  resolvedAt DateTime?

  @@map("alerts")
}

model DeviceStatus {
  id         String   @id @default("global-device")
  activeMode String // "sawah" or "kolam"
  battery    Float? // Battery percentage
  signal     Int? // Signal strength
  pumpStatus Boolean   @default(false)
  lastUpdate DateTime @updatedAt

  @@map("device_status")
}

model MonitoringLog {
  id            Int      @id @default(autoincrement())
  ph_value      Decimal  @db.Decimal(4, 2)
  battery_level Decimal? @db.Decimal(5, 2)
  location      String   @db.VarChar(58)
  created_at    DateTime @default(now())

  @@map("monitoring_logs")
}
